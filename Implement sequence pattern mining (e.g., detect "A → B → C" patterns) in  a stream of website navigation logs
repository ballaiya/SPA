from collections import defaultdict, deque

# Step 1: Simulated user clickstream (user_id, page)
clickstream = [
    (1, 'A'), (1, 'B'), (1, 'C'),        # Match
    (2, 'A'), (2, 'B'), (2, 'D'),        # No match
    (3, 'A'), (3, 'B'), (3, 'C'),        # Match
    (1, 'D'), (1, 'A'), (1, 'B'), (1, 'C'),  # Another match
    (4, 'B'), (4, 'A'), (4, 'C'),        # No match
]

# Step 2: Track user sessions (sliding window of 3)
user_sessions = defaultdict(lambda: deque(maxlen=3))
pattern = ['A', 'B', 'C']
match_count = 0

# Step 3: Process stream and detect pattern
for user_id, page in clickstream:
    user_sessions[user_id].append(page)
    if list(user_sessions[user_id]) == pattern:
        match_count += 1
        print(f"Pattern A → B → C detected for user {user_id}")

# Step 4: Final summary
print(f"\nTotal matches of pattern A → B → C: {match_count}")
